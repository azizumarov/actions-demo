name: Deploy to Azure

on:
  workflow_call:
    inputs:
      url:
        required: true
        type: string
      slot:
        required: true
        type: string
      env:
        required: true
        type: string
    secrets:
      token:
        required: true

jobs:

  deploy:
    name: "Deploy To Azure ${{ inputs.env }} env"
    
    runs-on: ubuntu-latest
    
    needs:
      - build-app
    
    environment:
      name: ${{ inputs.env }}
      url: ${{ inputs.url }}
    
    steps:
      - uses: actions/checkout@v3
  
      - name: Setup .NET Core 8
        uses: actions/setup-dotnet@v3
        with:
          dotnet-version: 8.0.x
  
      - name: 'Login via Azure CLI'
        uses: azure/login@v1
        with:
          creds: ${{ secrets.AZURE_CREDENTIALS }}
  
      - name: Download a Build Artifact
        uses: actions/download-artifact@v4
        with:
          # Artifact name
          name: 'blazorappbuildartifacts'
          # Destination path
          path: 'blazorappbuildartifacts'
      
      # Deploy to Azure Web apps
      - name: 'Run Azure webapp deploy action using publish profile credentials'
        uses: azure/webapps-deploy@v3
        with:
          app-name: blazorapp-actions
          package: 'blazorappbuildartifacts'
          slot-name: ${{ inputs.slot }}